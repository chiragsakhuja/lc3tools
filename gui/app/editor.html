<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>lc3edit</title>
        <!-- Bootstrap -->
        <link href="../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/styles.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script>window.$ = window.jQuery = require('jquery');</script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../node_modules/css-element-queries/src/ResizeSensor.js"></script>
        <script src="../node_modules/css-element-queries/src/ElementQueries.js"></script>
        <script>
            var ElementQueries = require('css-element-queries/src/ElementQueries');

            // attaches to DOMLoadContent and does anything for you
            ElementQueries.listen();
        </script>

        <script>
            // Monaco uses a custom amd loader that over-rides node's require.
            // Keep a reference to node's require so we can restore it after executing the amd loader file.
            var nodeRequire = global.require;
        </script>
        <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
        <script>
            // Save Monaco's amd require and restore Node's require
            var amdRequire = global.require;
            global.require = nodeRequire;
        </script>

        <script>
            // require node modules before loader.js comes in
            var path = require('path');

            function uriFromPath(_path) {
                var pathName = path.resolve(_path).replace(/\\/g, '/');
                if (pathName.length > 0 && pathName.charAt(0) !== '/') {
                    pathName = '/' + pathName;
                }
                return encodeURI('file://' + pathName);
            }

            amdRequire.config({
                baseUrl: uriFromPath(path.join(__dirname, '../node_modules/monaco-editor/min'))
            });

            // workaround monaco-css not understanding the environment
            self.module = undefined;

            // workaround monaco-typescript not understanding the environment
            self.process.browser = true;

            amdRequire(['vs/editor/editor.main'], function() {
                window.editor = monaco.editor.create(document.getElementById('editor'), {
                    value: [
                        'function x() {',
                        '\tconsole.log("Hello world!");',
                        '}'
                    ].join('\n'),
                    language: 'javascript',
                    theme: 'vs-dark'
                });
            });
        </script>
    </head>

    <body>
        <div class="container-fluid">
            <div class="panel panel-default" id="toolbar-panel">
                <div class="panel-body" id="toolbary-panel-body">
                    <div class="btn-group" role="group" aria-label="...">
                        <a href="#" role="button" class="btn btn-default btn-toolbar" id="toolbar-save"><span class="glyphicon glyphicon-floppy-disk glyphicon-toolbar"></span></a>
                        <a href="#" role="button" class="btn btn-default btn-toolbar" id="toolbar-open"><span class="glyphicon glyphicon-folder-open glyphicon-toolbar"></span></a>
                        <a href="#" role="button" class="btn btn-default btn-toolbar" id="toolbar-build"><span class="glyphicon glyphicon-wrench glyphicon-toolbar"></span></a>
                    </div>  
                </div>
            </div>
            <div class="panel panel-default" id="editor-panel">
                <div class="panel-body" id="editor-panel-body">
                    <div id="editor"></div>
                </div>
            </div>

            <div class="panel panel-default" id="console-panel">
                <div class="panel-body" id="console-panel-body">
                    <div id="console"></div>
                </div>
            </div>

        </div>

        <script>
            $(".btn").click(function(e) {
                // Removes focus of the button.
                $(this).blur();
            });

            const myAddon = require('bindings')('addon')
            $('#toolbar-build').on('click', function(e) {
                myAddon.Assemble('test.asm');
                $('#console').empty();
                $('#console').html(myAddon.GetOutput());
                $('#console-panel').stop().animate({
                    scrollTop: $('#console-panel')[0].scrollHeight
                }, 200);
            })

            $('#toolbar-save').on('click', function(e) {
                console.log(window.editor.getValue());
            });

            $(window).resize(function() {
                console.log("resize");
            });
        </script>

        <script>
            var element = document.getElementById('editor-panel');
            new ResizeSensor(element, function() {
                console.log('Changed to ' + element.clientWidth);
            });
        </script>

    </body>

</html>
